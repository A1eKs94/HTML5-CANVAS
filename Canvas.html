<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Canvas</title>
    <style>
      body {
        background-color: gray;
      }
      canvas {
        background-color: white;
      }
    </style>
  </head>
  <body>
    <canvas id="myCanvas" width="500" height="500"></canvas>

    <script>
      const myCanvas = document.getElementById("myCanvas");
      const ctx = myCanvas.getContext("2d");
      var figura = 1;
      var fillColor;
      var strokeColor;
      var isDrawing = false;

      class Rectangulo {
        constructor(alto, ancho, x, y, color, speed) {
          this.alto = alto;
          this.ancho = ancho;
          this.x = x;
          this.y = y;
          this.color = color;
          this.speed = speed;
        }

        colision(Rectangulo) {
          if (player.x < target.x + 10 && 
          player.x + 50 > target.x && 
          player.y < target.y + 10 && 
          player.y + 50 > target.y) {
          console.log("colision")
          return true;
        }
          return false;
        }
      }

      var player = new Rectangulo(50, 50, 100, 100, "red", 5);
      var target = new Rectangulo(10, 10, 150, 150, "black", 0);
      // Eventos

      function getRandomColor() {
        var letters = "0123456789ABCDEF";
        var color = "#";
        for (var i = 0; i < 6; i++) {
          color += letters[Math.floor(Math.random() * 16)];
        }
        return color;
      }

      document
        .getElementById("myCanvas")
        .addEventListener("mouseover", function (e) {
          fillColor = getRandomColor();
          strokeColor = getRandomColor();
        });

      // Cuadrado que se mueve

      var move = "";

      ctx.fillStyle = "Red";
      ctx.strokeColor = "Black";
      ctx.fillRect(player.x, player.y, 50, 50);

      document.addEventListener("keypress", function (e) {
        

        if (e.keyCode == 119) {
          move = "up";
        }
        if (e.keyCode == 115) {
          move = "down";
        }
        if (e.keyCode == 97) {
          move = "left";
        }
        if (e.keyCode == 100) {
          move = "right";
        }
        if (e.keyCode == 32) {
          player.speed += 1;
        }
      });

      function moveUpdate() {
        if (move == "up") {
          player.y -= player.speed;
        }
        if (move == "down") {
          player.y += player.speed;
        }
        if (move == "left") {
          player.x -= player.speed;
        }
        if (move == "right") {
          player.x += player.speed;
        }

        // En caso de que sobre pase los limites
        if (player.x < 0) {
          player.x = 499;
        }

        if (player.x > 500) {
          player.x = 0;
        }

        if (player.y < 0) {
          player.y = 499;
        }

        if (player.y > 500) {
          player.y = 0;
        }
        
        // Al colisionar
        if (player.colision(true)) {
          target.x = Math.floor(Math.random() * 500);
          target.y = Math.floor(Math.random() * 500);
        }
        paint();
      }

      function paint() {
        ctx.fillStyle = "white";
        ctx.fillRect(0, 0, 500, 500);

        ctx.font = "15px";
        ctx.fillStyle = "black";
        ctx.fillText("Speed: " + player.speed, 420, 20);

        // Jugador
        ctx.fillStyle = player.color;
        ctx.fillRect(player.x, player.y, player.alto, player.ancho);

        // Target
        ctx.fillStyle = target.color;
        ctx.fillRect(target.x, target.y, target.alto, target.ancho);
        requestAnimationFrame(moveUpdate);
      }

      requestAnimationFrame(paint);
    </script>
  </body>
</html>
